#Connect-AzureAD

#Get-AzureADSubscribedSku | Format-Table


$AvailableUnits = $Null
$AvailableUnits2 = $Null
$AvailableUnits=@()
$AvailableUnits2=@()
$PaidUnitsIntune = Get-AzureADSubscribedSku -ObjectId "e9a9ec5a-ac84-4d5c-92f4-452d6306d80d_99fc2803-fa72-42d3-ae78-b055e177d275" | select -Property Sku*,ConsumedUnits -ExpandProperty prepaidunits
$AvailableUnitsIntune = $Null
$AvailableUnitsIntune = (($PaidUnitsIntune.Enabled)-($PaidUnitsIntune.ConsumedUnits))
#if($AvailableUnitsIntune -lt 250 -and  $AvailableUnitsIntune  -gt 0)
if(($AvailableUnitsIntune -lt 250))
 { 
   if(($AvailableUnitsIntune -lt 1))
 { 
   $AvailableUnits2 += New-Object PSObject -property @{ 
                 Intune = "$AvailableUnitsIntune"
 }
 
 
 Function Send-Mail {
#Message Style
$body = "<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=516 style='width:387.0pt;margin-left:-.15pt;border-collapse:collapse;mso-yfti-tbllook: 1184;mso-padding-alt:0in 5.4pt 0in 5.4pt'> <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;height:15.0pt'> <td width=64 nowrap valign=bottom style='width:48.0pt;border:solid windowtext 1.0pt; mso-border-alt:solid windowtext .5pt;padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>Count<o:p></o:p></span></p> </td> <td width=64 nowrap valign=bottom style='width:48.0pt;border:solid windowtext 1.0pt; border-left:none;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt: solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding: 0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>SignIn<o:p></o:p></span></p> </td> <td width=83 nowrap valign=bottom style='width:62.0pt;border:solid windowtext 1.0pt; border-left:none;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt: solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding: 0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>INTDeniedGroupStatus<o:p></o:p></span></p> </td> <td width=76 nowrap valign=bottom style='width:57.0pt;border:solid windowtext 1.0pt; border-left:none;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt: solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding: 0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>EMMStatus<o:p></o:p></span></p> </td> <td width=92 nowrap valign=bottom style='width:69.0pt;border:solid windowtext 1.0pt; border-left:none;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt: solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding: 0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>LicenseStatus<o:p></o:p></span></p> </td> <td width=64 nowrap valign=bottom style='width:48.0pt;border:solid windowtext 1.0pt; border-left:none;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt: solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding: 0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>IsAdmin<o:p></o:p></span></p> </td> <td width=73 nowrap valign=bottom style='width:55.0pt;border:solid windowtext 1.0pt; border-left:none;mso-border-top-alt:solid windowtext .5pt;mso-border-bottom-alt: solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding: 0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>MFAStatus<o:p></o:p></span></p> </td> </tr> <tr style='mso-yfti-irow:1;height:15.0pt'> <td width=64 nowrap valign=bottom style='width:48.0pt;border:solid windowtext 1.0pt; border-top:none;mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt: solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding: 0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal align=center style='text-align:center'><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family:'Times New Roman'; mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri;color:black; mso-fareast-language:EN-IN'>TRUE<o:p></o:p></span></p> </td> <td width=64 nowrap valign=bottom style='width:48.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$SST<o:p></o:p></span></p> </td> <td width=83 nowrap valign=bottom style='width:62.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$GST<o:p></o:p></span></p> </td> <td width=76 nowrap valign=bottom style='width:57.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$EST<o:p></o:p></span></p> </td> <td width=92 nowrap valign=bottom style='width:69.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$LST<o:p></o:p></span></p> </td> <td width=64 nowrap valign=bottom style='width:48.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$ADT<o:p></o:p></span></p> </td> <td width=73 nowrap valign=bottom style='width:55.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$MFAT<o:p></o:p></span></p> </td> </tr> <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes;height:15.0pt'> <td width=64 nowrap valign=bottom style='width:48.0pt;border:solid windowtext 1.0pt; border-top:none;mso-border-left-alt:solid windowtext .5pt;mso-border-bottom-alt: solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt;padding: 0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal align=center style='text-align:center'><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family:'Times New Roman'; mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri;color:black; mso-fareast-language:EN-IN'>FALSE<o:p></o:p></span></p> </td> <td width=64 nowrap valign=bottom style='width:48.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$SSF<o:p></o:p></span></p> </td> <td width=83 nowrap valign=bottom style='width:62.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$GSF<o:p></o:p></span></p> </td> <td width=76 nowrap valign=bottom style='width:57.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$ESF<o:p></o:p></span></p> </td> <td width=92 nowrap valign=bottom style='width:69.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$LSF<o:p></o:p></span></p> </td> <td width=64 nowrap valign=bottom style='width:48.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$ADF<o:p></o:p></span></p> </td> <td width=73 nowrap valign=bottom style='width:55.0pt;border-top:none; border-left:none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt; mso-border-bottom-alt:solid windowtext .5pt;mso-border-right-alt:solid windowtext .5pt; padding:0in 5.4pt 0in 5.4pt;height:15.0pt'> <p class=MsoNormal><span style='mso-ascii-font-family:Calibri;mso-fareast-font-family: 'Times New Roman';mso-hansi-font-family:Calibri;mso-bidi-font-family:Calibri; color:black;mso-fareast-language:EN-IN'>$MFAF<o:p></o:p></span></p> </td> </tr> </table>"

#SendMail - to recipients
 $PSEmailServer = "smtpio.technicolor.com"
 $recipients = @("anand.kavil@technicolor.com")
 $msgsubject = "License_$((Get-Date -format yyyy-MMM-dd-ddd` hh-mm` tt).ToString())"
 Send-MailMessage -From "license@technicolor.com" -To $recipients -Subject $msgsubject -Body $body -BodyAsHtml -Attachments $ExportCSVReport
 }
 }
 }


{ $AvailableUnits += New-Object PSObject -property @{ Intune = "$AvailableUnitsIntune"} }

$AvailableUnits = @()  
 
Elseif ($AvailableUnitsIntune -lt 10 ){ $AvailableUnits2 += New-Object PSObject -property @{ Intune = "$AvailableUnitsIntune"} }




$PaidUnitsIntune = Get-AzureADSubscribedSku -ObjectId "e9a9ec5a-ac84-4d5c-92f4-452d6306d80d_99fc2803-fa72-42d3-ae78-b055e177d275" | select -Property Sku*,ConsumedUnits -ExpandProperty prepaidunits
$AvailableUnitsIntune = (($PaidUnitsIntune.Enabled)-($PaidUnitsIntune.ConsumedUnits))
Write-Output "License left over for Intune" $AvailableUnitsIntune | Out-GridView